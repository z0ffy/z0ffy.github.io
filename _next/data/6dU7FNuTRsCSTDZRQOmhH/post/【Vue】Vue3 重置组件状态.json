{"pageProps":{"post":{"id":21,"title":"【Vue】Vue3 重置组件状态","created_at":"2024-11-22T03:32:59Z","updated_at":"2024-11-22T03:33:21Z","content":"> 在某些场景下，例如表单提交，经常会需要重置表单状态。可以通过以下的方式进行组件状态优雅重置。\r\n\r\n### xxx写法\r\n\r\n```vue\r\n\r\n<template>\r\n  <div>\r\n    <div>{{ state.name }} - {{ state.age }}</div>\r\n    <div @click=\"resetState\">reset ref</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { reactive } from 'vue';\r\n\r\n  const state = reactive({\r\n    name: 1,\r\n    age: 2,\r\n  });\r\n\r\n  function resetState() {\r\n    state.name = 1;\r\n    state.age = 2;\r\n  }\r\n</script>\r\n```\r\n\r\n### Hook 封装\r\n\r\n```javascript\r\nimport { ref, reactive } from 'vue';\r\n\r\nfunction clone(value) {\r\n  return JSON.parse(JSON.stringify(value));\r\n}\r\n\r\nexport function useResettableRef(value) {\r\n  const initialValue = clone(value);\r\n  const state = ref(value);\r\n\r\n  const reset = () => {\r\n    state.value = clone(initialValue);\r\n  }\r\n\r\n  return [state, reset];\r\n}\r\n\r\nexport function useResettableReactive(value) {\r\n  const state = reactive(clone(value));\r\n\r\n  const reset = () => {\r\n    Object.keys(state).forEach((key) => delete state[key]);\r\n    Object.assign(state, clone(value));\r\n  }\r\n\r\n  return [state, reset];\r\n}\r\n```\r\n\r\n### Hook 使用\r\n\r\n```vue\r\n\r\n<template>\r\n  <div>\r\n    <div>ref：{{ refState.name }} - {{ refState.age }}</div>\r\n    <div @click=\"resetRefState\">reset ref</div>\r\n\r\n    <div>reactive：{{ reactiveState.name }} - {{ reactiveState.age }}</div>\r\n    <div @click=\"resetReactiveState\">reset ref</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n  import { useResettableRef, useResettableReactive } from '@/hooks/index.js';\r\n\r\n  const [refState, resetRefState] = useResettableRef({\r\n    name: 1,\r\n    age: 2\r\n  });\r\n\r\n  const [reactiveState, resetReactiveState] = useResettableReactive({\r\n    name: 1,\r\n    age: 2\r\n  });\r\n</script>\r\n```\r\n","author":"z0ffy","reactions":{"url":"https://api.github.com/repos/z0ffy/z0ffy.github.io/issues/21/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"labels":["published","前端","vue"]}},"__N_SSG":true}