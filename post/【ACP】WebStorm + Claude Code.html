<!DOCTYPE html><html lang="zh-CN" id="html"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><title data-next-head="">【ACP】WebStorm + Claude Code</title><meta name="description" content="## 前言

随着 JetBrains 在 2025.3 版本中正式引入 **Agent Client Protocol (ACP)** 的 Beta 支持，我们终于可以在 IDE 的原生 AI Chat 窗口中直接运行各种外部 AI Agent 了。

Anthropic 推出的 **Claude" data-next-head=""/><meta name="keywords" content="【ACP】WebStorm + Claude Code" data-next-head=""/><meta name="author" content="zoffy" data-next-head=""/><meta property="og:title" content="【ACP】WebStorm + Claude Code" data-next-head=""/><meta property="og:description" content="## 前言

随着 JetBrains 在 2025.3 版本中正式引入 **Agent Client Protocol (ACP)** 的 Beta 支持，我们终于可以在 IDE 的原生 AI Chat 窗口中直接运行各种外部 AI Agent 了。

Anthropic 推出的 **Claude" data-next-head=""/><meta property="og:type" content="article" data-next-head=""/><meta property="og:url" content="https://zoffy.me" data-next-head=""/><link rel="shortcut icon" href="/favicon.ico"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/chunks/6d81d75fe333818b.css" as="style"/><link rel="preload" href="/_next/static/chunks/c90e9ab7017dd0cd.css" as="style"/><link rel="stylesheet" href="/_next/static/chunks/6d81d75fe333818b.css" data-n-g=""/><link rel="stylesheet" href="/_next/static/chunks/c90e9ab7017dd0cd.css" data-n-p=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/b94f7f98a7b3fe6e.js" defer=""></script><script src="/_next/static/chunks/6c3568018efa7928.js" defer=""></script><script src="/_next/static/chunks/54acd6e72066cc1e.js" defer=""></script><script src="/_next/static/chunks/turbopack-ec51ffd7144b4250.js" defer=""></script><script src="/_next/static/chunks/c3a538815f2514b3.js" defer=""></script><script src="/_next/static/chunks/c285d21036d34ec1.js" defer=""></script><script src="/_next/static/chunks/66aca6b8088b3989.js" defer=""></script><script src="/_next/static/chunks/turbopack-c2ac5881891a11af.js" defer=""></script><script src="/_next/static/Kggx9iVOncMwKcmZbFoaT/_ssgManifest.js" defer=""></script><script src="/_next/static/Kggx9iVOncMwKcmZbFoaT/_buildManifest.js" defer=""></script></head><body class="dark:bg-black bg-slate-50"><div id="__next"><script>((e,i,s,u,m,a,l,h)=>{let d=document.documentElement,w=["light","dark"];function p(n){(Array.isArray(e)?e:[e]).forEach(y=>{let k=y==="class",S=k&&a?m.map(f=>a[f]||f):m;k?(d.classList.remove(...S),d.classList.add(a&&a[n]?a[n]:n)):d.setAttribute(y,n)}),R(n)}function R(n){h&&w.includes(n)&&(d.style.colorScheme=n)}function c(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(u)p(u);else try{let n=localStorage.getItem(i)||s,y=l&&n==="system"?c():n;p(y)}catch(n){}})("data-theme","theme","system",null,["light","dark"],null,true,true)</script><div class="flex flex-col h-screen container w-full md:w-3/4 xl:w-1/2"><header><div class="my-10 flex self-center flex-row justify-between"><div class="flex self-center flex-row justify-between"><a class="md:text-2xl text-xl cursor-pointer dark:hover:text-white dark:text-gray-400 text-gray-500 hover:text-black transition-colors duration-200 font-en" href="/">cd ..</a></div><div class="self-center text-sm sm:text-lg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2em" height="2em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M12 5q-.425 0-.712-.288Q11 4.425 11 4V2q0-.425.288-.713Q11.575 1 12 1t.713.287Q13 1.575 13 2v2q0 .425-.287.712Q12.425 5 12 5Zm4.95 2.05q-.275-.275-.275-.688q0-.412.275-.712l1.4-1.425q.3-.3.712-.3q.413 0 .713.3q.275.275.275.7q0 .425-.275.7L18.35 7.05q-.275.275-.7.275q-.425 0-.7-.275ZM20 13q-.425 0-.712-.288Q19 12.425 19 12t.288-.713Q19.575 11 20 11h2q.425 0 .712.287q.288.288.288.713t-.288.712Q22.425 13 22 13Zm-8 10q-.425 0-.712-.288Q11 22.425 11 22v-2q0-.425.288-.712Q11.575 19 12 19t.713.288Q13 19.575 13 20v2q0 .425-.287.712Q12.425 23 12 23ZM5.65 7.05l-1.425-1.4q-.3-.3-.3-.725t.3-.7q.275-.275.7-.275q.425 0 .7.275L7.05 5.65q.275.275.275.7q0 .425-.275.7q-.3.275-.7.275q-.4 0-.7-.275Zm12.7 12.725l-1.4-1.425q-.275-.3-.275-.712q0-.413.275-.688q.275-.275.688-.275q.412 0 .712.275l1.425 1.4q.3.275.287.7q-.012.425-.287.725q-.3.3-.725.3t-.7-.3ZM2 13q-.425 0-.712-.288Q1 12.425 1 12t.288-.713Q1.575 11 2 11h2q.425 0 .713.287Q5 11.575 5 12t-.287.712Q4.425 13 4 13Zm2.225 6.775q-.275-.275-.275-.7q0-.425.275-.7L5.65 16.95q.275-.275.688-.275q.412 0 .712.275q.3.3.3.713q0 .412-.3.712l-1.4 1.4q-.3.3-.725.3t-.7-.3ZM12 18q-2.5 0-4.25-1.75T6 12q0-2.5 1.75-4.25T12 6q2.5 0 4.25 1.75T18 12q0 2.5-1.75 4.25T12 18Zm0-2q1.65 0 2.825-1.175Q16 13.65 16 12q0-1.65-1.175-2.825Q13.65 8 12 8q-1.65 0-2.825 1.175Q8 10.35 8 12q0 1.65 1.175 2.825Q10.35 16 12 16Z"></path></svg></div></div></header><main class="grow"><div><div class="flex flex-col mb-2"><div class="text-4xl sm:text-4xl font-medium dark:text-gray-200">【ACP】WebStorm + Claude Code</div><div class="sm:text-lg text-sm mt-2 dark:text-gray-400"><span>2025年12月17日</span> / <span>2025年12月17日</span></div></div><br/><div class="font-normal"><h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">前言</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">随着 JetBrains 在 2025.3 版本中正式引入 <strong node="[object Object]" class="font-bold dark:text-gray-100">Agent Client Protocol (ACP)</strong> 的 Beta 支持，我们终于可以在 IDE 的原生 AI Chat 窗口中直接运行各种外部 AI Agent 了。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">Anthropic 推出的 <strong node="[object Object]" class="font-bold dark:text-gray-100">Claude Code</strong> 是一款强大的终端编码助手，结合 ACP 协议，它能与 WebStorm 实现无缝集成：<strong node="[object Object]" class="font-bold dark:text-gray-100">直接在 IDE 内进行多文件编辑、原生 Diff 预览以及代码重构。</strong></p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">但在实际配置过程中，很多开发者会遇到两个棘手问题：</p>
<ol node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="list-none my-1">使用 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm</code> (Fast Node Manager) 管理 Node 版本时，IDE 无法找到正确的 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">npx</code> 路径。</li>
<li class="list-none my-1">需要连接自定义的 API 地址（如 LiteLLM、Bedrock 或其它中转服务），而不是官方默认端点。</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">本文将提供一份经过实测的完整配置方案，帮你完美避坑。</p>
<hr node="[object Object]" class="border-gray-300 dark:border-gray-400 dark:border-dashed"/>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">🛠 前提条件</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">在开始之前，请确保你的开发环境满足以下要求：</p>
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">IDE 版本</strong>：WebStorm 2025.3 或更高版本。</li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">插件要求</strong>：已启用官方 <strong node="[object Object]" class="font-bold dark:text-gray-100">AI Assistant</strong> 插件。</li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">基础工具</strong>：
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1">已安装 Claude Code CLI（建议：<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">npm install -g @anthropic-ai/claude-code</code>）。</li>
<li class="list-none my-1">使用 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm</code> 管理 Node.js 环境。</li>
<li class="list-none my-1">终端运行 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">npx --version</code> 能正常输出。</li>
</ul>
</li>
</ul>
<hr node="[object Object]" class="border-gray-300 dark:border-gray-400 dark:border-dashed"/>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">🚀 配置步骤</h1>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">第一步：安装 ACP 适配器</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">我们需要一个“桥梁”将 Claude Code 转换为 IDE 能听懂的 ACP 协议。推荐使用 Zed 官方维护的适配器：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span class="token" style="color:#DD4A68">npm</span><span> </span><span class="token" style="color:#DD4A68">install</span><span> </span><span class="token parameter" style="color:#e90">-g</span><span> @zed-industries/claude-code-acp</span></code></div></pre>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">第二步：配置 WebStorm ACP</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">这是最关键的一步。我们需要通过修改配置文件来告诉 IDE 如何启动 Claude Code，并注入必要的环境变量。</p>
<ol node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="list-none my-1">打开 WebStorm，进入 <strong node="[object Object]" class="font-bold dark:text-gray-100">AI Chat</strong> 工具窗口（<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">View</code> → <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">Tool Windows</code> → <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">AI Chat</code>）。</li>
<li class="list-none my-1">点击窗口右上角的 <strong node="[object Object]" class="font-bold dark:text-gray-100">齿轮图标 ⚙️</strong>，选择 <strong node="[object Object]" class="font-bold dark:text-gray-100">Configure ACP Agents</strong>。</li>
<li class="list-none my-1">系统会自动打开 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">acp.json</code> 配置文件：
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">macOS / Linux</strong>: <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">~/.jetbrains/acp.json</code></li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">Windows</strong>: <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">%USERPROFILE%\.jetbrains\acp.json</code></li>
</ul>
</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">请将文件内容替换为以下配置（请根据实际情况修改 API Key 和 URL）：</p>
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">2</span><span>  </span><span class="token" style="color:#905">&quot;agent_servers&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">3</span><span>    </span><span class="token" style="color:#905">&quot;Claude Code (Custom)&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">4</span><span>      </span><span class="token" style="color:#905">&quot;command&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;/bin/zsh&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">5</span><span>      </span><span class="token" style="color:#905">&quot;args&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">[</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">6</span><span>        </span><span class="token" style="color:#690">&quot;-c&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">7</span><span>        </span><span class="token" style="color:#690">&quot;pkill -f &#x27;npx.*@zed-industries/claude-code-acp&#x27; || true; fnm exec -- npx @zed-industries/claude-code-acp&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">8</span><span>      </span><span class="token" style="color:#999">]</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">9</span><span>      </span><span class="token" style="color:#905">&quot;env&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">10</span><span>        </span><span class="token" style="color:#905">&quot;ANTHROPIC_API_KEY&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;your-custom-api-key-here&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">11</span><span>        </span><span class="token" style="color:#905">&quot;ANTHROPIC_BASE_URL&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;https://your-custom-api-url.com/v1&quot;</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">12</span><span>      </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">13</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">14</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">15</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">💡 配置原理解析（为什么这么写？）</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">这段配置看似复杂，实则解决两个核心痛点：</p>
<ol node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="list-none my-1">
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">自动清理僵尸进程 (<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">pkill ... || true</code>)</strong>：
每次重启 IDE 或 Agent 时，旧的进程可能依然驻留。这行命令会在启动新服务前强制清理旧的 adapter 进程，防止端口占用或内存泄漏。<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">|| true</code> 保证了即使没有旧进程，命令也不会报错退出。</p>
</li>
<li class="list-none my-1">
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">解决 fnm 路径问题 (<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm exec --</code>)</strong>：
WebStorm 启动子进程时，默认的 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">$PATH</code> 可能不包含 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm</code> 动态注入的 Node 路径。直接写 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">npx</code> 往往会报错。
使用 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm exec --</code> 可以强制在当前 shell 上下文中动态加载正确的 Node 环境，彻底解决“找不到命令”的问题。</p>
</li>
<li class="list-none my-1">
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">自定义 API 支持 (<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">env</code> 字段)</strong>：
通过显式注入 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">ANTHROPIC_BASE_URL</code>，你可以轻松切换到任何兼容 OpenAI/Anthropic 格式的接口（务必确保 URL 以 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">/v1</code> 结尾）。</p>
</li>
</ol>
<hr node="[object Object]" class="border-gray-300 dark:border-gray-400 dark:border-dashed"/>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">💻 使用方法</h1>
<ol node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="list-none my-1">保存 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">acp.json</code> 文件。</li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">完全重启 WebStorm</strong>（确保配置重载）。</li>
<li class="list-none my-1">打开 <strong node="[object Object]" class="font-bold dark:text-gray-100">AI Chat</strong> 窗口。</li>
<li class="list-none my-1">点击输入框上方的 Agent 选择下拉菜单，你应该能看到 <strong node="[object Object]" class="font-bold dark:text-gray-100">&quot;Claude Code (Custom)&quot;</strong>。</li>
<li class="list-none my-1">选中它，开始对话！尝试让它“重构当前文件”或“修复这个 Bug”，你会发现更改会直接显示在 IDE 的 Diff 视图中，体验极佳。</li>
</ol>
<hr node="[object Object]" class="border-gray-300 dark:border-gray-400 dark:border-dashed"/>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">❓ 常见问题排查 (FAQ)</h1>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">Q1: Agent 选项没有出现，或者启动报错怎么办？</strong></p>
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">查看日志</strong>：点击 AI Chat 窗口右上角齿轮 → <strong node="[object Object]" class="font-bold dark:text-gray-100">Get ACP Logs</strong>。</li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">检查 JSON</strong>：确保 JSON 格式合法（尤其是逗号和引号）。</li>
<li class="list-none my-1"><strong node="[object Object]" class="font-bold dark:text-gray-100">全局安装</strong>：确认适配器已安装：<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">npm ls -g @zed-industries/claude-code-acp</code>。</li>
</ul>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">Q2: 自定义 API 似乎没有生效？</strong></p>
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1">检查 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">ANTHROPIC_BASE_URL</code> 是否包含协议头（<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">https://</code>）和版本后缀（<code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">/v1</code>）。</li>
<li class="list-none my-1">建议先在终端手动测试连接：
<pre><div node="[object Object]" style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:1.8rem 0;overflow:auto;border-radius:0.5rem"><code class="font-en text-md" style="white-space:pre"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:slategray">1</span><span class="token assign-left" style="color:#e90">ANTHROPIC_API_KEY</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span>xxx </span><span class="token assign-left" style="color:#e90">ANTHROPIC_BASE_URL</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span>yyy npx @zed-industries/claude-code-acp</span></code></div></pre>
</li>
</ul>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><strong node="[object Object]" class="font-bold dark:text-gray-100">Q3: 为什么不直接使用 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">/bin/bash</code>？</strong></p>
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1">如果你是 macOS 用户，默认 Shell 通常是 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">zsh</code>，且 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">fnm</code> 配置通常在 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">~/.zshrc</code> 中。如果你使用 bash，请将配置中的 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">/bin/zsh</code> 改为 <code class="text-gray-600 dark:text-gray-200 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded" node="[object Object]">/bin/bash</code>。</li>
</ul>
<hr node="[object Object]" class="border-gray-300 dark:border-gray-400 dark:border-dashed"/>
<h1 class="sm:text-4xl text-3xl my-12 mb-6 dark:text-white font-medium">🔗 参考资料</h1>
<ul node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 my-5 dark:text-gray-300">
<li class="list-none my-1"><a href="https://www.jetbrains.com/help/ai-assistant/acp.html" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">JetBrains ACP 官方文档</a></li>
<li class="list-none my-1"><a href="https://github.com/zed-industries/claude-code-acp" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">Zed Claude Code ACP Adapter (GitHub)</a></li>
<li class="list-none my-1"><a href="https://code.claude.com/docs" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">Claude Code 官方文档</a></li>
</ul></div><br/><div></div><a class="float-right mt-10 sm:text-2xl text-xl text-gray-500 hover:text-black transition-colors duration-200 dark:text-gray-400 dark:hover:text-gray-100" href="/">cd ..</a></div></main><footer class="container mx-auto text-center text-gray-700 dark:text-gray-400"><div class="flex flex-row justify-center mb-5 space-x-5"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" fill-rule="evenodd" d="M3.5 3.25a.75.75 0 0 1 .75-.75C14.053 2.5 22 10.447 22 20.25a.75.75 0 0 1-1.5 0C20.5 11.275 13.225 4 4.25 4a.75.75 0 0 1-.75-.75zM3.5 19a2 2 0 1 1 4 0a2 2 0 0 1-4 0zm.75-9.5a.75.75 0 0 0 0 1.5a9.25 9.25 0 0 1 9.25 9.25a.75.75 0 0 0 1.5 0C15 14.313 10.187 9.5 4.25 9.5z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587Q2 18.825 2 18V6q0-.825.588-1.412Q3.175 4 4 4h16q.825 0 1.413.588Q22 5.175 22 6v12q0 .825-.587 1.413Q20.825 20 20 20ZM20 8l-7.475 4.675q-.125.075-.263.112q-.137.038-.262.038t-.262-.038q-.138-.037-.263-.112L4 8v10h16Zm-8 3l8-5H4ZM4 8v.25v-1.475v.025V6v.8v-.013V8.25V8v10Z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" cursor="pointer" viewBox="0 0 16 16"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.75 14.25s-.5-2 .5-3c0 0-2 0-3.5-1.5s-1-4.5 0-5.5c-.5-1.5.5-2.5.5-2.5s1.5 0 2.5 1c1-.5 3.5-.5 4.5 0c1-1 2.5-1 2.5-1s1 1 .5 2.5c1 1 1.5 4 0 5.5s-3.5 1.5-3.5 1.5c1 1 .5 3 .5 3m-5-.5c-1.5.5-3-.5-3.5-1"></path></svg></div><div class="flex items-center flex-wrap mb-10 font-en justify-center"><span>©<!-- -->2026<!-- -->. </span><span>All rights reserved by </span><a href="https://github.com/z0ffy" class="text-blue-500 hover:text-blue-900 transition-colors duration-300">z0ffy</a><span>.</span></div></footer><div class="bottom-10 right-10 cursor-pointer fixed hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="opacity-0 duration-700 transition-opacity ease-in-out"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19h14a2 2 0 0 0 1.84-2.75L13.74 4a2 2 0 0 0-3.5 0l-7.1 12.25A2 2 0 0 0 4.89 19"></path></svg></div><div id="sakana-widget" class="cursor-pointer bottom-0 left-16 fixed hidden xl:block"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":37,"title":"【ACP】WebStorm + Claude Code","created_at":"2025-12-17T09:28:39Z","updated_at":"2025-12-17T09:28:48Z","content":"## 前言\n\n随着 JetBrains 在 2025.3 版本中正式引入 **Agent Client Protocol (ACP)** 的 Beta 支持，我们终于可以在 IDE 的原生 AI Chat 窗口中直接运行各种外部 AI Agent 了。\n\nAnthropic 推出的 **Claude Code** 是一款强大的终端编码助手，结合 ACP 协议，它能与 WebStorm 实现无缝集成：**直接在 IDE 内进行多文件编辑、原生 Diff 预览以及代码重构。**\n\n但在实际配置过程中，很多开发者会遇到两个棘手问题：\n1.  使用 `fnm` (Fast Node Manager) 管理 Node 版本时，IDE 无法找到正确的 `npx` 路径。\n2.  需要连接自定义的 API 地址（如 LiteLLM、Bedrock 或其它中转服务），而不是官方默认端点。\n\n本文将提供一份经过实测的完整配置方案，帮你完美避坑。\n\n---\n\n## 🛠 前提条件\n\n在开始之前，请确保你的开发环境满足以下要求：\n\n*   **IDE 版本**：WebStorm 2025.3 或更高版本。\n*   **插件要求**：已启用官方 **AI Assistant** 插件。\n*   **基础工具**：\n    *   已安装 Claude Code CLI（建议：`npm install -g @anthropic-ai/claude-code`）。\n    *   使用 `fnm` 管理 Node.js 环境。\n    *   终端运行 `npx --version` 能正常输出。\n\n---\n\n## 🚀 配置步骤\n\n### 第一步：安装 ACP 适配器\n\n我们需要一个“桥梁”将 Claude Code 转换为 IDE 能听懂的 ACP 协议。推荐使用 Zed 官方维护的适配器：\n\n```bash\nnpm install -g @zed-industries/claude-code-acp\n```\n\n### 第二步：配置 WebStorm ACP\n\n这是最关键的一步。我们需要通过修改配置文件来告诉 IDE 如何启动 Claude Code，并注入必要的环境变量。\n\n1.  打开 WebStorm，进入 **AI Chat** 工具窗口（`View` → `Tool Windows` → `AI Chat`）。\n2.  点击窗口右上角的 **齿轮图标 ⚙️**，选择 **Configure ACP Agents**。\n3.  系统会自动打开 `acp.json` 配置文件：\n    *   **macOS / Linux**: `~/.jetbrains/acp.json`\n    *   **Windows**: `%USERPROFILE%\\.jetbrains\\acp.json`\n\n请将文件内容替换为以下配置（请根据实际情况修改 API Key 和 URL）：\n\n```json\n{\n  \"agent_servers\": {\n    \"Claude Code (Custom)\": {\n      \"command\": \"/bin/zsh\",\n      \"args\": [\n        \"-c\",\n        \"pkill -f 'npx.*@zed-industries/claude-code-acp' || true; fnm exec -- npx @zed-industries/claude-code-acp\"\n      ],\n      \"env\": {\n        \"ANTHROPIC_API_KEY\": \"your-custom-api-key-here\",\n        \"ANTHROPIC_BASE_URL\": \"https://your-custom-api-url.com/v1\"\n      }\n    }\n  }\n}\n```\n\n### 💡 配置原理解析（为什么这么写？）\n\n这段配置看似复杂，实则解决两个核心痛点：\n\n1.  **自动清理僵尸进程 (`pkill ... || true`)**：\n    每次重启 IDE 或 Agent 时，旧的进程可能依然驻留。这行命令会在启动新服务前强制清理旧的 adapter 进程，防止端口占用或内存泄漏。`|| true` 保证了即使没有旧进程，命令也不会报错退出。\n\n2.  **解决 fnm 路径问题 (`fnm exec --`)**：\n    WebStorm 启动子进程时，默认的 `$PATH` 可能不包含 `fnm` 动态注入的 Node 路径。直接写 `npx` 往往会报错。\n    使用 `fnm exec --` 可以强制在当前 shell 上下文中动态加载正确的 Node 环境，彻底解决“找不到命令”的问题。\n\n3.  **自定义 API 支持 (`env` 字段)**：\n    通过显式注入 `ANTHROPIC_BASE_URL`，你可以轻松切换到任何兼容 OpenAI/Anthropic 格式的接口（务必确保 URL 以 `/v1` 结尾）。\n\n---\n\n## 💻 使用方法\n\n1.  保存 `acp.json` 文件。\n2.  **完全重启 WebStorm**（确保配置重载）。\n3.  打开 **AI Chat** 窗口。\n4.  点击输入框上方的 Agent 选择下拉菜单，你应该能看到 **\"Claude Code (Custom)\"**。\n5.  选中它，开始对话！尝试让它“重构当前文件”或“修复这个 Bug”，你会发现更改会直接显示在 IDE 的 Diff 视图中，体验极佳。\n\n---\n\n## ❓ 常见问题排查 (FAQ)\n\n**Q1: Agent 选项没有出现，或者启动报错怎么办？**\n*   **查看日志**：点击 AI Chat 窗口右上角齿轮 → **Get ACP Logs**。\n*   **检查 JSON**：确保 JSON 格式合法（尤其是逗号和引号）。\n*   **全局安装**：确认适配器已安装：`npm ls -g @zed-industries/claude-code-acp`。\n\n**Q2: 自定义 API 似乎没有生效？**\n*   检查 `ANTHROPIC_BASE_URL` 是否包含协议头（`https://`）和版本后缀（`/v1`）。\n*   建议先在终端手动测试连接：\n    ```bash\n    ANTHROPIC_API_KEY=xxx ANTHROPIC_BASE_URL=yyy npx @zed-industries/claude-code-acp\n    ```\n\n**Q3: 为什么不直接使用 `/bin/bash`？**\n*   如果你是 macOS 用户，默认 Shell 通常是 `zsh`，且 `fnm` 配置通常在 `~/.zshrc` 中。如果你使用 bash，请将配置中的 `/bin/zsh` 改为 `/bin/bash`。\n\n---\n\n## 🔗 参考资料\n\n*   [JetBrains ACP 官方文档](https://www.jetbrains.com/help/ai-assistant/acp.html)\n*   [Zed Claude Code ACP Adapter (GitHub)](https://github.com/zed-industries/claude-code-acp)\n*   [Claude Code 官方文档](https://code.claude.com/docs)\n","author":"z0ffy","reactions":{"url":"https://api.github.com/repos/z0ffy/z0ffy.github.io/issues/37/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"labels":["published","ai"]}},"__N_SSG":true},"page":"/post/[id]","query":{"id":"【ACP】WebStorm + Claude Code"},"buildId":"Kggx9iVOncMwKcmZbFoaT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>